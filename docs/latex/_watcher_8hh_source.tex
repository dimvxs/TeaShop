\doxysection{Watcher.\+hh}
\hypertarget{_watcher_8hh_source}{}\label{_watcher_8hh_source}\index{frontend/node\_modules/"@parcel/watcher/src/Watcher.hh@{frontend/node\_modules/"@parcel/watcher/src/Watcher.hh}}
\mbox{\hyperlink{_watcher_8hh}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{preprocessor}{\#ifndef\ WATCHER\_H}}
\DoxyCodeLine{00002\ \textcolor{preprocessor}{\#define\ WATCHER\_H}}
\DoxyCodeLine{00003\ }
\DoxyCodeLine{00004\ \textcolor{preprocessor}{\#include\ <condition\_variable>}}
\DoxyCodeLine{00005\ \textcolor{preprocessor}{\#include\ <unordered\_set>}}
\DoxyCodeLine{00006\ \textcolor{preprocessor}{\#include\ <set>}}
\DoxyCodeLine{00007\ \textcolor{preprocessor}{\#include\ <node\_api.h>}}
\DoxyCodeLine{00008\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{_glob_8hh}{Glob.hh}}"{}}}
\DoxyCodeLine{00009\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{_event_8hh}{Event.hh}}"{}}}
\DoxyCodeLine{00010\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{_debounce_8hh}{Debounce.hh}}"{}}}
\DoxyCodeLine{00011\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{_dir_tree_8hh}{DirTree.hh}}"{}}}
\DoxyCodeLine{00012\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{_signal_8hh}{Signal.hh}}"{}}}
\DoxyCodeLine{00013\ }
\DoxyCodeLine{00014\ \textcolor{keyword}{using\ namespace\ }\mbox{\hyperlink{namespace_napi}{Napi}};}
\DoxyCodeLine{00015\ }
\DoxyCodeLine{00016\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{struct_watcher}{Watcher}};}
\DoxyCodeLine{00017\ \textcolor{keyword}{using\ }\mbox{\hyperlink{_watcher_8hh_a8a32f1740da49095a86d32383c012cc9}{WatcherRef}}\ =\ std::shared\_ptr<Watcher>;}
\DoxyCodeLine{00018\ }
\DoxyCodeLine{00019\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{struct_callback}{Callback}}\ \{}
\DoxyCodeLine{00020\ \ \ Napi::ThreadSafeFunction\ \mbox{\hyperlink{struct_callback_a9fd3e061fe7abf58f3fcd88c3e970c4d}{tsfn}};}
\DoxyCodeLine{00021\ \ \ \mbox{\hyperlink{class_napi_1_1_function_reference}{Napi::FunctionReference}}\ \mbox{\hyperlink{struct_callback_a2ae76e90cf432ce3636031eb0a0a3f99}{ref}};}
\DoxyCodeLine{00022\ \ \ std::thread::id\ \mbox{\hyperlink{struct_callback_ade3b5503896d08cc16a75c518a422057}{threadId}};}
\DoxyCodeLine{00023\ \};}
\DoxyCodeLine{00024\ }
\DoxyCodeLine{00025\ \textcolor{keyword}{class\ }\mbox{\hyperlink{class_watcher_state}{WatcherState}}\ \{}
\DoxyCodeLine{00026\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00027\ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{class_watcher_state_a21e2df4b3c29afaafd0be3f6df9bb710}{\string~WatcherState}}()\ =\ \textcolor{keywordflow}{default};}
\DoxyCodeLine{00028\ \};}
\DoxyCodeLine{00029\ }
\DoxyCodeLine{00030\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{struct_watcher_a99356e7c319134ff88e8bdd121efcf0d}{Watcher}}\ \{}
\DoxyCodeLine{00031\ \ \ std::string\ \mbox{\hyperlink{struct_watcher_a83428ab27a42c95b96911e3a8211876e}{mDir}};}
\DoxyCodeLine{00032\ \ \ std::unordered\_set<std::string>\ \mbox{\hyperlink{struct_watcher_a39330ad481100a71d5217f2c8bc02ced}{mIgnorePaths}};}
\DoxyCodeLine{00033\ \ \ std::unordered\_set<Glob>\ \mbox{\hyperlink{struct_watcher_a7ffc9433db04f723952b4d134758154f}{mIgnoreGlobs}};}
\DoxyCodeLine{00034\ \ \ \mbox{\hyperlink{class_event_list}{EventList}}\ \mbox{\hyperlink{struct_watcher_a06cf1fb43fbc6448b4d329f559e07f64}{mEvents}};}
\DoxyCodeLine{00035\ \ \ std::shared\_ptr<WatcherState>\ \mbox{\hyperlink{struct_watcher_a62cd0a3167f48db2e1cd41fd425bf57d}{state}};}
\DoxyCodeLine{00036\ }
\DoxyCodeLine{00037\ \ \ \mbox{\hyperlink{struct_watcher_a99356e7c319134ff88e8bdd121efcf0d}{Watcher}}(std::string\ dir,\ std::unordered\_set<std::string>\ ignorePaths,\ std::unordered\_set<Glob>\ ignoreGlobs);}
\DoxyCodeLine{00038\ \ \ \mbox{\hyperlink{struct_watcher_a84db4a7c7f7c7d3a62104713920678c8}{\string~Watcher}}();}
\DoxyCodeLine{00039\ }
\DoxyCodeLine{00040\ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{struct_watcher_af8497f1321d3f0505ff0096540370a68}{operator==}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{struct_watcher_a99356e7c319134ff88e8bdd121efcf0d}{Watcher}}\ \&other)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00041\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{struct_watcher_a83428ab27a42c95b96911e3a8211876e}{mDir}}\ ==\ other.\mbox{\hyperlink{struct_watcher_a83428ab27a42c95b96911e3a8211876e}{mDir}}\ \&\&\ \mbox{\hyperlink{struct_watcher_a39330ad481100a71d5217f2c8bc02ced}{mIgnorePaths}}\ ==\ other.\mbox{\hyperlink{struct_watcher_a39330ad481100a71d5217f2c8bc02ced}{mIgnorePaths}}\ \&\&\ \mbox{\hyperlink{struct_watcher_a7ffc9433db04f723952b4d134758154f}{mIgnoreGlobs}}\ ==\ other.\mbox{\hyperlink{struct_watcher_a7ffc9433db04f723952b4d134758154f}{mIgnoreGlobs}};}
\DoxyCodeLine{00042\ \ \ \}}
\DoxyCodeLine{00043\ }
\DoxyCodeLine{00044\ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{struct_watcher_a3ba7abfdc6dbf51d361a4451a00e4b3d}{wait}}();}
\DoxyCodeLine{00045\ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{struct_watcher_aa525380da86c818ad61d182460963712}{notify}}();}
\DoxyCodeLine{00046\ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{struct_watcher_a068e899ec6899b93d598b21bd54cefbe}{notifyError}}(std::exception\ \&err);}
\DoxyCodeLine{00047\ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{struct_watcher_a2e11f4c2edbb391a73ad2d60bbf7e7f4}{watch}}(\mbox{\hyperlink{class_napi_1_1_function}{Function}}\ callback);}
\DoxyCodeLine{00048\ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{struct_watcher_abcad882e24905c6d4cfd0a91b9c32d83}{unwatch}}(\mbox{\hyperlink{class_napi_1_1_function}{Function}}\ callback);}
\DoxyCodeLine{00049\ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{struct_watcher_a848e0ba54581cdc2a89348bf3c370f93}{unref}}();}
\DoxyCodeLine{00050\ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{struct_watcher_ab68d175922930045322434c1fa34b6fa}{isIgnored}}(std::string\ path);}
\DoxyCodeLine{00051\ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{struct_watcher_a189c7c3c042b546c4284c0c8a0dd7998}{destroy}}();}
\DoxyCodeLine{00052\ }
\DoxyCodeLine{00053\ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{_watcher_8hh_a8a32f1740da49095a86d32383c012cc9}{WatcherRef}}\ \mbox{\hyperlink{struct_watcher_af1339c6345ff707c2d312e215b5b11d5}{getShared}}(std::string\ dir,\ std::unordered\_set<std::string>\ ignorePaths,\ std::unordered\_set<Glob>\ ignoreGlobs);}
\DoxyCodeLine{00054\ }
\DoxyCodeLine{00055\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00056\ \ \ std::mutex\ mMutex;}
\DoxyCodeLine{00057\ \ \ std::condition\_variable\ mCond;}
\DoxyCodeLine{00058\ \ \ std::vector<Callback>\ mCallbacks;}
\DoxyCodeLine{00059\ \ \ std::shared\_ptr<Debounce>\ mDebounce;}
\DoxyCodeLine{00060\ }
\DoxyCodeLine{00061\ \ \ std::vector<Callback>::iterator\ findCallback(\mbox{\hyperlink{class_napi_1_1_function}{Function}}\ callback);}
\DoxyCodeLine{00062\ \ \ \textcolor{keywordtype}{void}\ clearCallbacks();}
\DoxyCodeLine{00063\ \ \ \textcolor{keywordtype}{void}\ triggerCallbacks();}
\DoxyCodeLine{00064\ \};}
\DoxyCodeLine{00065\ }
\DoxyCodeLine{00066\ \textcolor{keyword}{class\ }\mbox{\hyperlink{class_watcher_error_aa84f0d2c9aded17384e456d69c050599}{WatcherError}}\ :\ \textcolor{keyword}{public}\ std::runtime\_error\ \{}
\DoxyCodeLine{00067\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00068\ \ \ \mbox{\hyperlink{_watcher_8hh_a8a32f1740da49095a86d32383c012cc9}{WatcherRef}}\ \mbox{\hyperlink{class_watcher_error_aed6a6621b97c1feecc61c5e88448de06}{mWatcher}};}
\DoxyCodeLine{00069\ \ \ \mbox{\hyperlink{class_watcher_error_aa84f0d2c9aded17384e456d69c050599}{WatcherError}}(std::string\ msg,\ \mbox{\hyperlink{_watcher_8hh_a8a32f1740da49095a86d32383c012cc9}{WatcherRef}}\ watcher)\ :\ \mbox{\hyperlink{namespacestd}{std}}::runtime\_error(msg),\ \mbox{\hyperlink{class_watcher_error_aed6a6621b97c1feecc61c5e88448de06}{mWatcher}}(watcher)\ \{\}}
\DoxyCodeLine{00070\ \ \ \mbox{\hyperlink{class_watcher_error_a110b5cc87abe3fdbe45b6daf140252e2}{WatcherError}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *msg,\ \mbox{\hyperlink{_watcher_8hh_a8a32f1740da49095a86d32383c012cc9}{WatcherRef}}\ watcher)\ :\ \mbox{\hyperlink{namespacestd}{std}}::runtime\_error(msg),\ \mbox{\hyperlink{class_watcher_error_aed6a6621b97c1feecc61c5e88448de06}{mWatcher}}(watcher)\ \{\}}
\DoxyCodeLine{00071\ \};}
\DoxyCodeLine{00072\ }
\DoxyCodeLine{00073\ \textcolor{preprocessor}{\#endif}}

\end{DoxyCode}
