\doxysection{Event.\+hh}
\hypertarget{_event_8hh_source}{}\label{_event_8hh_source}\index{frontend/node\_modules/"@parcel/watcher/src/Event.hh@{frontend/node\_modules/"@parcel/watcher/src/Event.hh}}
\mbox{\hyperlink{_event_8hh}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{preprocessor}{\#ifndef\ EVENT\_H}}
\DoxyCodeLine{00002\ \textcolor{preprocessor}{\#define\ EVENT\_H}}
\DoxyCodeLine{00003\ }
\DoxyCodeLine{00004\ \textcolor{preprocessor}{\#include\ <string>}}
\DoxyCodeLine{00005\ \textcolor{preprocessor}{\#include\ <node\_api.h>}}
\DoxyCodeLine{00006\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{include_8h}{wasm/include.h}}"{}}}
\DoxyCodeLine{00007\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{napi_8h}{napi.h}}>}}
\DoxyCodeLine{00008\ \textcolor{preprocessor}{\#include\ <mutex>}}
\DoxyCodeLine{00009\ \textcolor{preprocessor}{\#include\ <map>}}
\DoxyCodeLine{00010\ \textcolor{preprocessor}{\#include\ <optional>}}
\DoxyCodeLine{00011\ }
\DoxyCodeLine{00012\ \textcolor{keyword}{using\ namespace\ }\mbox{\hyperlink{namespace_napi}{Napi}};}
\DoxyCodeLine{00013\ }
\DoxyCodeLine{00014\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{struct_event_a60eb82065e270b05f9185e856a5b4378}{Event}}\ \{}
\DoxyCodeLine{00015\ \ \ std::string\ \mbox{\hyperlink{struct_event_a3a5b728aab844e43b3d12f95bdef0e9e}{path}};}
\DoxyCodeLine{00016\ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{struct_event_a9d791bdfbf271e80ac24d407fd05304c}{isCreated}};}
\DoxyCodeLine{00017\ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{struct_event_a07733de0974e09a47abffabc85806f33}{isDeleted}};}
\DoxyCodeLine{00018\ \ \ \mbox{\hyperlink{struct_event_a60eb82065e270b05f9185e856a5b4378}{Event}}(std::string\ \mbox{\hyperlink{struct_event_a3a5b728aab844e43b3d12f95bdef0e9e}{path}})\ :\ \mbox{\hyperlink{struct_event_a3a5b728aab844e43b3d12f95bdef0e9e}{path}}(\mbox{\hyperlink{struct_event_a3a5b728aab844e43b3d12f95bdef0e9e}{path}}),\ \mbox{\hyperlink{struct_event_a9d791bdfbf271e80ac24d407fd05304c}{isCreated}}(false),\ \mbox{\hyperlink{struct_event_a07733de0974e09a47abffabc85806f33}{isDeleted}}(false)\ \{\}}
\DoxyCodeLine{00019\ }
\DoxyCodeLine{00020\ \ \ \mbox{\hyperlink{class_napi_1_1_value}{Value}}\ \mbox{\hyperlink{struct_event_a0253348149d94efad259e0aff3b37fa0}{toJS}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{class_napi_1_1_env}{Env}}\&\ env)\ \{}
\DoxyCodeLine{00021\ \ \ \ \ \mbox{\hyperlink{class_napi_1_1_escapable_handle_scope}{EscapableHandleScope}}\ scope(env);}
\DoxyCodeLine{00022\ \ \ \ \ \mbox{\hyperlink{class_napi_1_1_object}{Object}}\ res\ =\ \mbox{\hyperlink{class_napi_1_1_object_aa92b5f3a7c5b1735312133993d6d1a9b}{Object::New}}(env);}
\DoxyCodeLine{00023\ \ \ \ \ std::string\ type\ =\ \mbox{\hyperlink{struct_event_a9d791bdfbf271e80ac24d407fd05304c}{isCreated}}\ ?\ \textcolor{stringliteral}{"{}create"{}}\ :\ \mbox{\hyperlink{struct_event_a07733de0974e09a47abffabc85806f33}{isDeleted}}\ ?\ \textcolor{stringliteral}{"{}delete"{}}\ :\ \textcolor{stringliteral}{"{}update"{}};}
\DoxyCodeLine{00024\ \ \ \ \ res.\mbox{\hyperlink{class_napi_1_1_object_ab58533f930d4f81b41cc5ef6e96ce589}{Set}}(\mbox{\hyperlink{class_napi_1_1_string_a6689d69d07bad4eea2be440333320925}{String::New}}(env,\ \textcolor{stringliteral}{"{}path"{}}),\ \mbox{\hyperlink{class_napi_1_1_string_a6689d69d07bad4eea2be440333320925}{String::New}}(env,\ \mbox{\hyperlink{struct_event_a3a5b728aab844e43b3d12f95bdef0e9e}{path}}.c\_str()));}
\DoxyCodeLine{00025\ \ \ \ \ res.\mbox{\hyperlink{class_napi_1_1_object_ab58533f930d4f81b41cc5ef6e96ce589}{Set}}(\mbox{\hyperlink{class_napi_1_1_string_a6689d69d07bad4eea2be440333320925}{String::New}}(env,\ \textcolor{stringliteral}{"{}type"{}}),\ \mbox{\hyperlink{class_napi_1_1_string_a6689d69d07bad4eea2be440333320925}{String::New}}(env,\ type.c\_str()));}
\DoxyCodeLine{00026\ \ \ \ \ \textcolor{keywordflow}{return}\ scope.\mbox{\hyperlink{class_napi_1_1_escapable_handle_scope_a3d278b44f79ed180083cbdfa75a3f058}{Escape}}(res);}
\DoxyCodeLine{00027\ \ \ \}}
\DoxyCodeLine{00028\ \};}
\DoxyCodeLine{00029\ }
\DoxyCodeLine{00030\ \textcolor{keyword}{class\ }\mbox{\hyperlink{class_event_list}{EventList}}\ \{}
\DoxyCodeLine{00031\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00032\ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_event_list_a19418a280e57ba52773d86d69974d986}{create}}(std::string\ path)\ \{}
\DoxyCodeLine{00033\ \ \ \ \ std::lock\_guard<std::mutex>\ l(mMutex);}
\DoxyCodeLine{00034\ \ \ \ \ \mbox{\hyperlink{struct_event}{Event}}\ *\textcolor{keyword}{event}\ =\ internalUpdate(path);}
\DoxyCodeLine{00035\ \ \ \ \ \textcolor{keywordflow}{if}\ (event-\/>isDeleted)\ \{}
\DoxyCodeLine{00036\ \ \ \ \ \ \ \textcolor{comment}{//\ Assume\ update\ event\ when\ rapidly\ removed\ and\ created}}
\DoxyCodeLine{00037\ \ \ \ \ \ \ \textcolor{comment}{//\ https://github.com/parcel-\/bundler/watcher/issues/72}}
\DoxyCodeLine{00038\ \ \ \ \ \ \ \textcolor{keyword}{event}-\/>isDeleted\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00039\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00040\ \ \ \ \ \ \ \textcolor{keyword}{event}-\/>isCreated\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00041\ \ \ \ \ \}}
\DoxyCodeLine{00042\ \ \ \}}
\DoxyCodeLine{00043\ }
\DoxyCodeLine{00044\ \ \ \mbox{\hyperlink{struct_event}{Event}}\ *\mbox{\hyperlink{class_event_list_a098cea32f373ce70648c95962c370ed3}{update}}(std::string\ path)\ \{}
\DoxyCodeLine{00045\ \ \ \ \ std::lock\_guard<std::mutex>\ l(mMutex);}
\DoxyCodeLine{00046\ \ \ \ \ \textcolor{keywordflow}{return}\ internalUpdate(path);}
\DoxyCodeLine{00047\ \ \ \}}
\DoxyCodeLine{00048\ }
\DoxyCodeLine{00049\ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_event_list_aa394dc7e3c155148ded119821cc2642e}{remove}}(std::string\ path)\ \{}
\DoxyCodeLine{00050\ \ \ \ \ std::lock\_guard<std::mutex>\ l(mMutex);}
\DoxyCodeLine{00051\ \ \ \ \ \mbox{\hyperlink{struct_event}{Event}}\ *\textcolor{keyword}{event}\ =\ internalUpdate(path);}
\DoxyCodeLine{00052\ \ \ \ \ \textcolor{keyword}{event}-\/>isDeleted\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00053\ \ \ \}}
\DoxyCodeLine{00054\ }
\DoxyCodeLine{00055\ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{class_event_list_af1d3176302ed7d7185fb7d2f615fa12d}{size}}()\ \{}
\DoxyCodeLine{00056\ \ \ \ \ std::lock\_guard<std::mutex>\ l(mMutex);}
\DoxyCodeLine{00057\ \ \ \ \ \textcolor{keywordflow}{return}\ mEvents.size();}
\DoxyCodeLine{00058\ \ \ \}}
\DoxyCodeLine{00059\ }
\DoxyCodeLine{00060\ \ \ std::vector<Event>\ \mbox{\hyperlink{class_event_list_ac33b09394fab21284532fadf31e90b83}{getEvents}}()\ \{}
\DoxyCodeLine{00061\ \ \ \ \ std::lock\_guard<std::mutex>\ l(mMutex);}
\DoxyCodeLine{00062\ \ \ \ \ std::vector<Event>\ eventsCloneVector;}
\DoxyCodeLine{00063\ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keyword}{auto}\ it\ =\ mEvents.begin();\ it\ !=\ mEvents.end();\ ++it)\ \{}
\DoxyCodeLine{00064\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!(it-\/>second.isCreated\ \&\&\ it-\/>second.isDeleted))\ \{}
\DoxyCodeLine{00065\ \ \ \ \ \ \ \ \ eventsCloneVector.push\_back(it-\/>second);}
\DoxyCodeLine{00066\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00067\ \ \ \ \ \}}
\DoxyCodeLine{00068\ \ \ \ \ \textcolor{keywordflow}{return}\ eventsCloneVector;}
\DoxyCodeLine{00069\ \ \ \}}
\DoxyCodeLine{00070\ }
\DoxyCodeLine{00071\ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_event_list_adc4919477556791a771843fc66bf3160}{clear}}()\ \{}
\DoxyCodeLine{00072\ \ \ \ \ std::lock\_guard<std::mutex>\ l(mMutex);}
\DoxyCodeLine{00073\ \ \ \ \ mEvents.clear();}
\DoxyCodeLine{00074\ \ \ \ \ mError.reset();}
\DoxyCodeLine{00075\ \ \ \}}
\DoxyCodeLine{00076\ }
\DoxyCodeLine{00077\ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_event_list_a7568c36717f7ff86e3ad450838ba548c}{error}}(std::string\ err)\ \{}
\DoxyCodeLine{00078\ \ \ \ \ std::lock\_guard<std::mutex>\ l(mMutex);}
\DoxyCodeLine{00079\ \ \ \ \ \textcolor{keywordflow}{if}\ (!mError.has\_value())\ \{}
\DoxyCodeLine{00080\ \ \ \ \ \ \ mError.emplace(err);}
\DoxyCodeLine{00081\ \ \ \ \ \}}
\DoxyCodeLine{00082\ \ \ \}}
\DoxyCodeLine{00083\ }
\DoxyCodeLine{00084\ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{class_event_list_a6cddaf82fe3f1764ef6552976160b2d3}{hasError}}()\ \{}
\DoxyCodeLine{00085\ \ \ \ \ std::lock\_guard<std::mutex>\ l(mMutex);}
\DoxyCodeLine{00086\ \ \ \ \ \textcolor{keywordflow}{return}\ mError.has\_value();}
\DoxyCodeLine{00087\ \ \ \}}
\DoxyCodeLine{00088\ }
\DoxyCodeLine{00089\ \ \ std::string\ \mbox{\hyperlink{class_event_list_a64c532b02a30f73165ced83e43490ead}{getError}}()\ \{}
\DoxyCodeLine{00090\ \ \ \ \ std::lock\_guard<std::mutex>\ l(mMutex);}
\DoxyCodeLine{00091\ \ \ \ \ \textcolor{keywordflow}{return}\ mError.value\_or(\textcolor{stringliteral}{"{}"{}});}
\DoxyCodeLine{00092\ \ \ \}}
\DoxyCodeLine{00093\ }
\DoxyCodeLine{00094\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00095\ \ \ \textcolor{keyword}{mutable}\ std::mutex\ mMutex;}
\DoxyCodeLine{00096\ \ \ std::map<std::string,\ Event>\ mEvents;}
\DoxyCodeLine{00097\ \ \ std::optional<std::string>\ mError;}
\DoxyCodeLine{00098\ \ \ \mbox{\hyperlink{struct_event}{Event}}\ *internalUpdate(std::string\ path)\ \{}
\DoxyCodeLine{00099\ \ \ \ \ \textcolor{keyword}{auto}\ found\ =\ mEvents.find(path);}
\DoxyCodeLine{00100\ \ \ \ \ \textcolor{keywordflow}{if}\ (found\ ==\ mEvents.end())\ \{}
\DoxyCodeLine{00101\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ it\ =\ mEvents.emplace(path,\ \mbox{\hyperlink{struct_event}{Event}}(path));}
\DoxyCodeLine{00102\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \&it.first-\/>second;}
\DoxyCodeLine{00103\ \ \ \ \ \}}
\DoxyCodeLine{00104\ }
\DoxyCodeLine{00105\ \ \ \ \ \textcolor{keywordflow}{return}\ \&found-\/>second;}
\DoxyCodeLine{00106\ \ \ \}}
\DoxyCodeLine{00107\ \};}
\DoxyCodeLine{00108\ }
\DoxyCodeLine{00109\ \textcolor{preprocessor}{\#endif}}

\end{DoxyCode}
