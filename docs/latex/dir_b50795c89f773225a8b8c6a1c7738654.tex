\doxysection{frontend/node\+\_\+modules/@parcel/watcher Directory Reference}
\hypertarget{dir_b50795c89f773225a8b8c6a1c7738654}{}\label{dir_b50795c89f773225a8b8c6a1c7738654}\index{frontend/node\_modules/"@parcel/watcher Directory Reference@{frontend/node\_modules/"@parcel/watcher Directory Reference}}
Directory dependency graph for watcher\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=228pt]{dir_b50795c89f773225a8b8c6a1c7738654_dep}
\end{center}
\end{figure}
\doxysubsubsection*{Directories}
\begin{DoxyCompactItemize}
\item 
directory \mbox{\hyperlink{dir_9226bfeebfabc95393ec9435475a7e2c}{src}}
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
\hypertarget{dir_b50795c89f773225a8b8c6a1c7738654_autotoc_md390}{}\doxysubsection{\texorpdfstring{@parcel/watcher}{@parcel/watcher}}\label{dir_b50795c89f773225a8b8c6a1c7738654_autotoc_md390}
A native C++ Node module for querying and subscribing to filesystem events. Used by \href{https://github.com/parcel-bundler/parcel}{\texttt{Parcel 2}}.\hypertarget{dir_b50795c89f773225a8b8c6a1c7738654_autotoc_md391}{}\doxysubsection{\texorpdfstring{Features}{Features}}\label{dir_b50795c89f773225a8b8c6a1c7738654_autotoc_md391}

\begin{DoxyItemize}
\item {\bfseries{Watch}} -\/ subscribe to realtime recursive directory change notifications when files or directories are created, updated, or deleted.
\item {\bfseries{Query}} -\/ performantly query for historical change events in a directory, even when your program is not running.
\item {\bfseries{Native}} -\/ implemented in C++ for performance and low-\/level integration with the operating system.
\item {\bfseries{Cross platform}} -\/ includes backends for mac\+OS, Linux, Windows, Free\+BSD, and Watchman.
\item {\bfseries{Performant}} -\/ events are throttled in C++ so the Java\+Script thread is not overwhelmed during large filesystem changes (e.\+g. {\ttfamily git checkout} or {\ttfamily npm install}).
\item {\bfseries{Scalable}} -\/ tens of thousands of files can be watched or queried at once with good performance.
\end{DoxyItemize}\hypertarget{dir_b50795c89f773225a8b8c6a1c7738654_autotoc_md392}{}\doxysubsection{\texorpdfstring{Example}{Example}}\label{dir_b50795c89f773225a8b8c6a1c7738654_autotoc_md392}

\begin{DoxyCode}{0}
\DoxyCodeLine{const\ watcher\ =\ require('@parcel/watcher');}
\DoxyCodeLine{const\ path\ =\ require('path');}
\DoxyCodeLine{}
\DoxyCodeLine{//\ Subscribe\ to\ events}
\DoxyCodeLine{let\ subscription\ =\ await\ watcher.subscribe(process.cwd(),\ (err,\ events)\ =>\ \{}
\DoxyCodeLine{\ \ console.log(events);}
\DoxyCodeLine{\});}
\DoxyCodeLine{}
\DoxyCodeLine{//\ later\ on...}
\DoxyCodeLine{await\ subscription.unsubscribe();}
\DoxyCodeLine{}
\DoxyCodeLine{//\ Get\ events\ since\ some\ saved\ snapshot\ in\ the\ past}
\DoxyCodeLine{let\ snapshotPath\ =\ path.join(process.cwd(),\ 'snapshot.txt');}
\DoxyCodeLine{let\ events\ =\ await\ watcher.getEventsSince(process.cwd(),\ snapshotPath);}
\DoxyCodeLine{}
\DoxyCodeLine{//\ Save\ a\ snapshot\ for\ later}
\DoxyCodeLine{await\ watcher.writeSnapshot(process.cwd(),\ snapshotPath);}

\end{DoxyCode}
\hypertarget{dir_b50795c89f773225a8b8c6a1c7738654_autotoc_md393}{}\doxysubsection{\texorpdfstring{Watching}{Watching}}\label{dir_b50795c89f773225a8b8c6a1c7738654_autotoc_md393}
{\ttfamily @parcel/watcher} supports subscribing to realtime notifications of changes in a directory. It works recursively, so changes in sub-\/directories will also be emitted.

Events are throttled and coalesced for performance during large changes like {\ttfamily git checkout} or {\ttfamily npm install}, and a single notification will be emitted with all of the events at the end.

Only one notification will be emitted per file. For example, if a file was both created and updated since the last event, you\textquotesingle{}ll get only a {\ttfamily create} event. If a file is both created and deleted, you will not be notifed of that file. Renames cause two events\+: a {\ttfamily delete} for the old name, and a {\ttfamily create} for the new name.


\begin{DoxyCode}{0}
\DoxyCodeLine{let\ subscription\ =\ await\ watcher.subscribe(process.cwd(),\ (err,\ events)\ =>\ \{}
\DoxyCodeLine{\ \ console.log(events);}
\DoxyCodeLine{\});}

\end{DoxyCode}


Events have two properties\+:


\begin{DoxyItemize}
\item {\ttfamily type} -\/ the event type\+: {\ttfamily create}, {\ttfamily update}, or {\ttfamily delete}.
\item {\ttfamily path} -\/ the absolute path to the file or directory.
\end{DoxyItemize}

To unsubscribe from change notifications, call the {\ttfamily \doxylink{binding_8cc_a9ad8bb9fc246697efe9410ab834fb542}{unsubscribe}} method on the returned subscription object.


\begin{DoxyCode}{0}
\DoxyCodeLine{await\ subscription.unsubscribe();}

\end{DoxyCode}


{\ttfamily @parcel/watcher} has the following watcher backends, listed in priority order\+:


\begin{DoxyItemize}
\item \href{https://developer.apple.com/documentation/coreservices/file_system_events}{\texttt{FSEvents}} on mac\+OS
\item \href{https://facebook.github.io/watchman/}{\texttt{Watchman}} if installed
\item \href{http://man7.org/linux/man-pages/man7/inotify.7.html}{\texttt{inotify}} on Linux
\item \href{https://msdn.microsoft.com/en-us/library/windows/desktop/aa365465\%28v\%3Dvs.85\%29.aspx}{\texttt{Read\+Directory\+ChangesW}} on Windows
\item \href{https://man.freebsd.org/cgi/man.cgi?kqueue}{\texttt{kqueue}} on Free\+BSD, or as an alternative to FSEvents on mac\+OS
\end{DoxyItemize}

You can specify the exact backend you wish to use by passing the {\ttfamily backend} option. If that backend is not available on the current platform, the default backend will be used instead. See below for the list of backend names that can be passed to the options.\hypertarget{dir_b50795c89f773225a8b8c6a1c7738654_autotoc_md394}{}\doxysubsection{\texorpdfstring{Querying}{Querying}}\label{dir_b50795c89f773225a8b8c6a1c7738654_autotoc_md394}
{\ttfamily @parcel/watcher} also supports querying for historical changes made in a directory, even when your program is not running. This makes it easy to invalidate a cache and re-\/build only the files that have changed, for example. It can be {\bfseries{significantly}} faster than traversing the entire filesystem to determine what files changed, depending on the platform.

In order to query for historical changes, you first need a previous snapshot to compare to. This can be saved to a file with the {\ttfamily \doxylink{binding_8cc_a6cc0b70fc62df1a6f8067edcb98ea2e1}{write\+Snapshot}} function, e.\+g. just before your program exits.


\begin{DoxyCode}{0}
\DoxyCodeLine{await\ watcher.writeSnapshot(dirPath,\ snapshotPath);}

\end{DoxyCode}


When your program starts up, you can query for changes that have occurred since that snapshot using the {\ttfamily \doxylink{binding_8cc_a4c13209c94593195cbc219ac01bd6a71}{get\+Events\+Since}} function.


\begin{DoxyCode}{0}
\DoxyCodeLine{let\ events\ =\ await\ watcher.getEventsSince(dirPath,\ snapshotPath);}

\end{DoxyCode}


The events returned are exactly the same as the events that would be passed to the {\ttfamily \doxylink{binding_8cc_ae4051216d69f763625c311af8ecb1aaf}{subscribe}} callback (see above).

{\ttfamily @parcel/watcher} has the following watcher backends, listed in priority order\+:


\begin{DoxyItemize}
\item \href{https://developer.apple.com/documentation/coreservices/file_system_events}{\texttt{FSEvents}} on mac\+OS
\item \href{https://facebook.github.io/watchman/}{\texttt{Watchman}} if installed
\item \href{http://man7.org/linux/man-pages/man3/fts.3.html}{\texttt{fts}} (brute force) on Linux and Free\+BSD
\item \href{https://docs.microsoft.com/en-us/windows/desktop/api/fileapi/nf-fileapi-findfirstfilea}{\texttt{Find\+First\+File}} (brute force) on Windows
\end{DoxyItemize}

The FSEvents (mac\+OS) and Watchman backends are significantly more performant than the brute force backends used by default on Linux and Windows, for example returning results in miliseconds instead of seconds for large directory trees. This is because a background daemon monitoring filesystem changes on those platforms allows us to query cached data rather than traversing the filesystem manually (brute force).

mac\+OS has good performance with FSEvents by default. For the best performance on other platforms, install \href{https://facebook.github.io/watchman/}{\texttt{Watchman}} and it will be used by {\ttfamily @parcel/watcher} automatically.

You can specify the exact backend you wish to use by passing the {\ttfamily backend} option. If that backend is not available on the current platform, the default backend will be used instead. See below for the list of backend names that can be passed to the options.\hypertarget{dir_b50795c89f773225a8b8c6a1c7738654_autotoc_md395}{}\doxysubsection{\texorpdfstring{Options}{Options}}\label{dir_b50795c89f773225a8b8c6a1c7738654_autotoc_md395}
All of the APIs in {\ttfamily @parcel/watcher} support the following options, which are passed as an object as the last function argument.


\begin{DoxyItemize}
\item {\ttfamily ignore} -\/ an array of paths or glob patterns to ignore. uses \href{https://github.com/micromatch/is-glob}{\texttt{{\ttfamily is-\/glob}}} to distinguish paths from globs. glob patterns are parsed with \href{https://github.com/micromatch/micromatch}{\texttt{{\ttfamily micromatch}}} (see \href{https://github.com/micromatch/micromatch\#matching-features}{\texttt{features}}).
\begin{DoxyItemize}
\item paths can be relative or absolute and can either be files or directories. No events will be emitted about these files or directories or their children.
\item glob patterns match on relative paths from the root that is watched. No events will be emitted for matching paths.
\end{DoxyItemize}
\item {\ttfamily backend} -\/ the name of an explicitly chosen backend to use. Allowed options are {\ttfamily "{}fs-\/events"{}}, {\ttfamily "{}watchman"{}}, {\ttfamily "{}inotify"{}}, {\ttfamily "{}kqueue"{}}, {\ttfamily "{}windows"{}}, or {\ttfamily "{}brute-\/force"{}} (only for querying). If the specified backend is not available on the current platform, the default backend will be used instead.
\end{DoxyItemize}\hypertarget{dir_b50795c89f773225a8b8c6a1c7738654_autotoc_md396}{}\doxysubsection{\texorpdfstring{WASM}{WASM}}\label{dir_b50795c89f773225a8b8c6a1c7738654_autotoc_md396}
The {\ttfamily @parcel/watcher-\/wasm} package can be used in place of {\ttfamily @parcel/watcher} on unsupported platforms. It relies on the Node {\ttfamily fs} module, so in non-\/\+Node environments such as browsers, an {\ttfamily fs} polyfill will be needed.

{\bfseries{Note}}\+: the WASM implementation is significantly less efficient than the native implementations because it must crawl the file system to watch each directory individually. Use the native {\ttfamily @parcel/watcher} package wherever possible.


\begin{DoxyCode}{0}
\DoxyCodeLine{import\ \{subscribe\}\ from\ '@parcel/watcher-\/wasm';}
\DoxyCodeLine{}
\DoxyCodeLine{//\ Use\ the\ module\ as\ documented\ above.}
\DoxyCodeLine{subscribe(/*\ ...\ */);}

\end{DoxyCode}
\hypertarget{dir_b50795c89f773225a8b8c6a1c7738654_autotoc_md397}{}\doxysubsection{\texorpdfstring{Who is using this?}{Who is using this?}}\label{dir_b50795c89f773225a8b8c6a1c7738654_autotoc_md397}

\begin{DoxyItemize}
\item \href{https://parceljs.org/}{\texttt{Parcel 2}}
\item \href{https://code.visualstudio.com/updates/v1_62\#_file-watching-changes}{\texttt{VSCode}}
\item \href{https://github.com/tailwindlabs/tailwindcss-intellisense}{\texttt{Tailwind CSS Intellisense}}
\item \href{https://twitter.com/chatsidhartha/status/1435647412828196867}{\texttt{Gatsby Cloud}}
\item \href{https://nx.dev}{\texttt{Nx}}
\item \href{https://nuxt.com}{\texttt{Nuxt}}
\end{DoxyItemize}\hypertarget{dir_b50795c89f773225a8b8c6a1c7738654_autotoc_md398}{}\doxysubsection{\texorpdfstring{License}{License}}\label{dir_b50795c89f773225a8b8c6a1c7738654_autotoc_md398}
MIT 
